(()=>{"use strict";class t{static target;subs;constructor(){this.subs=[]}addSub(t){this.subs.push(t)}depend(){t.target&&t.target.addDep(this)}notify(){for(let t=0,e=this.subs.length;t<e;t++)this.subs[t].update()}}function e(e,s,n){const r=Object.getOwnPropertyDescriptor(e,s),c=r&&r.get,l=r&&r.set;c&&!l||2!==arguments.length||(n=e[s]);const o=new t;Object.defineProperty(e,s,{enumerable:!0,configurable:!0,get:function(){const s=c?c.call(e):n;return t.target&&o.depend(),s},set:function(t){c&&c.call(e),l?l.call(e,t):n=t,o.notify()}})}t.target=null;const s={text:"hello, world"};new class{constructor(t){this.walk(t)}walk(t){const s=Object.keys(t);for(let n=0;n<s.length;n++)e(t,s[n])}}(s),new class{constructor(t){this.getter=t,this.get()}get(){let e;t.target=this;try{e=this.getter.call()}catch(t){throw t}return e}addDep(t){t.addSub(this)}update(){this.run()}run(){this.get()}}((()=>{console.log("收到",s.text)})),s.text="hello, liang"})();